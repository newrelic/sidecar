#
# DO NOT EDIT THIS FILE
# Auto-generated by Sidecar at {{ now }} 
#

global
	daemon
{{ if .User }}	user {{ .User }} {{ end }}
{{ if .Group }}	group {{ .Group }} {{ end }}
	maxconn 4096
	log     127.0.0.1 local0
	log     127.0.0.1 local1 notice
	stats   socket /var/run/haproxy_stats.sock mode 666 level admin

defaults
	log      global
	option   dontlognull
	maxconn  4096
	retries  3
	timeout  connect 5s
	timeout  client  1m
	timeout  server  1m
	option   redispatch
	balance  roundrobin

# -------------- STATS --------------
frontend stats
	mode http
	bind 0.0.0.0:3212
	default_backend stats

backend stats
	mode http
	stats enable
	stats uri /
	stats refresh 5s

{{ range $svcName, $services := .Services }} {{ range $svcPort, $port := getPorts $svcName }}
# ----------- {{ $svcName }} port {{ $svcPort }} --------------
frontend {{ sanitizeName $svcName }}-{{ $svcPort }}
	mode http
	bind {{ bindIP }}:{{ $svcPort }}
	default_backend {{ sanitizeName $svcName }}-{{ $svcPort }}

backend {{ sanitizeName $svcName }}-{{ $svcPort }}
	mode http {{ range $services }}
	server {{ .Hostname }}-{{ .ID }} {{ .Hostname }}:{{ $port }} cookie {{ .Hostname }}-{{ $port }} {{ end }}
{{ end }}
{{ end }}
